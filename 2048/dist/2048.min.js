/*! 2048 17-07--2015*/
function prepareForMobile(){documentWidth>500&&(gridContainerWidth=500,cellSidelength=100,cellSpace=20);var a=$("header"),b=a.find("p"),c=a.find("a");a.css("width",gridContainerWidth-2*cellSpace),a.css("padding",cellSpace/2+"px "+cellSpace+"px"),a.css("height",.28*gridContainerWidth),a.find("h1").css("font-size",.7*cellSidelength+"px"),c.css("font-size",.04*gridContainerWidth+"px"),c.css("padding",.03*gridContainerWidth+"px "+.02*gridContainerWidth+"px"),b.css("font-size",.05*gridContainerWidth+"px"),b.css("margin",.02*gridContainerWidth+"px auto"),b.css("padding",.03*gridContainerWidth+"px "+.02*gridContainerWidth+"px");var d=$("#grid-container");d.css("width",gridContainerWidth-2*cellSpace),d.css("height",gridContainerWidth-2*cellSpace),d.css("padding",cellSpace),d.css("border-radius",.02*gridContainerWidth);var e=$(".grid-cell");e.css("width",cellSidelength),e.css("height",cellSidelength),e.css("border-radius",.06*cellSidelength);var f=$("#over-cell");f.css("border-radius",.02*gridContainerWidth),f.css("font-size",.12*gridContainerWidth+"px"),f.css("line-height",.68*gridContainerWidth+"px")}function newgame(){init(),generateOneNumber(),generateOneNumber()}function init(){for(var a=0;4>a;a++)for(var b=0;4>b;b++){var c=$("#grid-cell-"+a+"-"+b);c.css("top",getPosTop(a,b)),c.css("left",getPosLeft(a,b)),c.css("left",getPosLeft(a,b))}for(var a=0;4>a;a++){board[a]=new Array,hasConflicted[a]=new Array;for(var b=0;4>b;b++)board[a][b]=0;hasConflicted[a][b]=!1}$("#over-cell").find("p").text(""),$("#over-cell").css("width","0px"),$("#over-cell").css("height","0px"),$("#over-cell").css("top",gridContainerWidth/2),$("#over-cell").css("left",gridContainerWidth/2),updateBoardView(),score=0}function updateBoardView(){$(".number-cell").remove();for(var a=0;4>a;a++)for(var b=0;4>b;b++){$("#grid-container").append('<div class="number-cell" id="number-cell-'+a+"-"+b+'">');var c=$("#number-cell-"+a+"-"+b);0==board[a][b]?(c.css("width","0px"),c.css("height","0px"),c.css("top",getPosTop(a,b)+cellSidelength/2),c.css("left",getPosLeft(a,b)+cellSidelength/2)):(c.css("width",cellSidelength),c.css("height",cellSidelength),c.css("top",getPosTop(a,b)),c.css("left",getPosLeft(a,b)),c.css("background-color",getNumberBackgroudColor(board[a][b])),c.css("color",getNumberColor(board[a][b])),c.text(board[a][b])),hasConflicted[a][b]=!1}$(".number-cell").css("border-radius",.06*cellSidelength),$(".number-cell").css("line-height",cellSidelength+"px"),$(".number-cell").css("font-size",.6*cellSidelength+"px")}function generateOneNumber(){if(nospace(board))return!1;for(var a=parseInt(Math.floor(4*Math.random())),b=parseInt(Math.floor(4*Math.random())),c=0;50>c&&0!=board[a][b];)a=parseInt(Math.floor(4*Math.random())),b=parseInt(Math.floor(4*Math.random())),c++;if(50==c)for(var d=0;4>d;d++)for(var e=0;4>e;e++)0==board[d][e]&&(a=d,b=e);var f=Math.random()<.5?2:4;return board[a][b]=f,showNumberWithAnimation(a,b,f),!0}function isgameover(){nospace(board)&&noMove(board)&&gameover()}function gameover(){showOverAnimation()}function moveLeft(){if(!canMoveLeft(board))return!1;for(var a=0;4>a;a++)for(var b=1;4>b;b++)if(0!=board[a][b])for(var c=0;b>c;c++)0==board[a][c]&&noBlockHorizontal(a,c,b,board)?(showMoveAnimation(a,b,a,c),board[a][c]=board[a][b],board[a][b]=0):board[a][c]!=board[a][b]||!noBlockHorizontal(a,c,b,board)||hasConflicted[a][c]||(showMoveAnimation(a,b,a,c),board[a][c]+=board[a][b],board[a][b]=0,score+=board[a][c],updatescore(score),hasConflicted[a][c]=!0);return setTimeout("updateBoardView()",180),!0}function moveUp(){if(!canMoveUp(board))return!1;for(var a=0;4>a;a++)for(var b=1;4>b;b++)if(0!=board[b][a])for(var c=0;b>c;c++)0==board[c][a]&&noBlockvertical(a,c,b,board)?(showMoveAnimation(b,a,c,a),board[c][a]=board[b][a],board[b][a]=0):board[c][a]!=board[b][a]||!noBlockvertical(a,c,b,board)||hasConflicted[c][a]||(showMoveAnimation(b,a,c,a),board[c][a]+=board[b][a],board[b][a]=0,score+=board[c][a],updatescore(score),hasConflicted[c][a]=!0);return setTimeout("updateBoardView()",180),!0}function moveRight(){if(!canMoveRight(board))return!1;for(var a=0;4>a;a++)for(var b=2;b>=0;b--)if(0!=board[a][b])for(var c=3;c>b;c--)0==board[a][c]&&noBlockHorizontal(a,b,c,board)?(showMoveAnimation(a,b,a,c),board[a][c]=board[a][b],board[a][b]=0):board[a][c]!=board[a][b]||!noBlockHorizontal(a,b,c,board)||hasConflicted[a][c]||(showMoveAnimation(a,b,a,c),board[a][c]+=board[a][b],board[a][b]=0,score+=board[a][c],updatescore(score),hasConflicted[a][c]=!0);return setTimeout("updateBoardView()",180),!0}function moveDown(){if(!canMoveDown(board))return!1;for(var a=0;4>a;a++)for(var b=2;b>=0;b--)if(0!=board[b][a])for(var c=3;c>b;c--)0==board[c][a]&&noBlockvertical(a,b,c,board)?(showMoveAnimation(b,a,c,a),board[c][a]=board[b][a],board[b][a]=0):board[c][a]!=board[b][a]||!noBlockvertical(a,b,c,board)||hasConflicted[c][a]||(showMoveAnimation(b,a,c,a),board[c][a]+=board[b][a],board[b][a]=0,score+=board[c][a],updatescore(score),hasConflicted[c][a]=!0);return setTimeout("updateBoardView()",180),!0}function showNumberWithAnimation(a,b,c){var d=$("#number-cell-"+a+"-"+b);d.css("background-color",getNumberBackgroudColor(c)),d.css("color",getNumberColor(c)),d.text(c),d.animate({width:cellSidelength,height:cellSidelength,top:getPosTop(a,b),left:getPosLeft(a,b)},60)}function showMoveAnimation(a,b,c,d){var e=$("#number-cell-"+a+"-"+b);e.animate({top:getPosTop(c,d),left:getPosLeft(c,d)},180)}function showOverAnimation(){var a=$("#over-cell");a.find("p").text("Game Over!"),a.animate({width:gridContainerWidth,height:gridContainerWidth,top:0,left:0},60)}function getPosTop(a,b){return cellSpace+a*(cellSidelength+cellSpace)}function getPosLeft(a,b){return cellSpace+b*(cellSidelength+cellSpace)}function getNumberBackgroudColor(a){switch(a){case 2:return"#eee4da";case 4:return"#ede0c8";case 8:return"#f2b179";case 16:return"#f59563";case 32:return"#f67c5f";case 64:return"#f65e3b";case 128:return"#edcf72";case 256:return"#edcc61";case 512:return"#9c0";case 1024:return"#33b5e5";case 2048:return"#09c";case 4096:return"#a6c";case 8192:return"#93c"}return"#000"}function getNumberColor(a){return 4>=a?"#776e65":"#fff"}function nospace(a){for(var b=0;4>b;b++)for(var c=0;4>c;c++)if(0==a[b][c])return!1;return!0}function noMove(a){return canMoveLeft(a)||canMoveRight(a)||canMoveUp(a)||canMoveDown(a)?!1:!0}function canMoveLeft(a){for(var b=0;4>b;b++)for(var c=1;4>c;c++)if(0!=a[b][c]&&(0==a[b][c-1]||a[b][c-1]==a[b][c]))return!0;return!1}function canMoveRight(a){for(var b=0;4>b;b++)for(var c=2;c>=0;c--)if(0!=a[b][c]&&(0==a[b][c+1]||a[b][c+1]==a[b][c]))return!0;return!1}function canMoveUp(a){for(var b=0;4>b;b++)for(var c=1;4>c;c++)if(0!=a[c][b]&&(0==a[c-1][b]||a[c-1][b]==a[c][b]))return!0;return!1}function canMoveDown(a){for(var b=0;4>b;b++)for(var c=2;c>=0;c--)if(0!=a[c][b]&&(0==a[c+1][b]||a[c+1][b]==a[c][b]))return!0;return!1}function noBlockHorizontal(a,b,c,d){for(var e=b+1;c>e;e++)if(0!=d[a][e])return!1;return!0}function noBlockvertical(a,b,c,d){for(var e=b+1;c>e;e++)if(0!=d[e][a])return!1;return!0}function updatescore(a){$("#score").text(a)}var board=new Array,score=0,hasConflicted=new Array,startx=0;starty=0,endx=0,endy=0,$(document).ready(function(){prepareForMobile(),newgame()}),$(document).keydown(function(a){switch(a.keyCode){case 37:a.preventDefault(),moveLeft()&&(setTimeout("generateOneNumber()",180),setTimeout("isgameover()",260));break;case 38:a.preventDefault(),moveUp()&&(setTimeout("generateOneNumber()",180),setTimeout("isgameover()",260));break;case 39:a.preventDefault(),moveRight()&&(setTimeout("generateOneNumber()",180),setTimeout("isgameover()",260));break;case 40:a.preventDefault(),moveDown()&&(setTimeout("generateOneNumber()",180),setTimeout("isgameover()",260))}}),document.addEventListener("touchstart",function(a){startx=a.touches[0].pageX,starty=a.touches[0].pageY}),document.addEventListener("touchmove",function(a){a.stopPropagation(),a.preventDefault()}),document.addEventListener("touchend",function(a){endx=a.changedTouches[0].pageX,endy=a.changedTouches[0].pageY;var b=endx-startx,c=endy-starty;Math.abs(b)<.3*documentWidth&&Math.abs(c)<.3*documentWidth||(Math.abs(b)>=Math.abs(c)?b>0?moveRight()&&(setTimeout("generateOneNumber()",180),setTimeout("isgameover()",260)):moveLeft()&&(setTimeout("generateOneNumber()",180),setTimeout("isgameover()",260)):c>0?moveDown()&&(setTimeout("generateOneNumber()",180),setTimeout("isgameover()",260)):moveUp()&&(setTimeout("generateOneNumber()",180),setTimeout("isgameover()",260)))}),documentWidth=window.screen.availWidth,gridContainerWidth=.92*documentWidth,cellSidelength=.18*documentWidth,cellSpace=.04*documentWidth;